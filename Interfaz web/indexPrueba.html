<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitor</title>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
  <link rel="stylesheet" href="stilesPrueba.css" />

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
  
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
</head>
<body>

  <div class="main-container">
    <div id="sidebar">
      <h2>Panel de Control</h2>
      <span class="tooltip-container">

        ‚ùì<small id="session-id-display" style="display: block; text-align: center; width: 100%; margin-bottom: 5px;">
              Cargando ID...
            </small>
      <span class="tooltip-text">Este es el identificador √∫nico de este monitoreo. util para posteriores revisiones.</span>
      </span>   
      
      
      <div class="menu-bar">
        <button id="tab-live" class="menu-btn">üì° Vivo</button>
        <button id="tab-history" class="menu-btn">üìÖ Ruta</button>
        <button id="tab-geofence" class="menu-btn">üìê Zona</button>
      </div>

      <div id="view-live" class="content-view" style="display: none;">
        <div class="info-box">
          <p>Monitoreo en tiempo real.</p>
          <span class="tooltip-container">
              ‚ùì 
              <span class="tooltip-text">Muestra ultima ubicacion en la que se encuentra el dispositivo.</span>
          </span>
        </div>
        <button id="btn-center-map" class="action-btn">üåç Centrar Mapa</button>
        <div id="user-list">Cargando...</div>
      </div>

      <div id="view-history" class="content-view" style="display: none;">
        <div class="info-box"><p>Ver recorrido completo.</p></div>
        <div class="history-controls">
            <label>Dispositivo:</label>
            <select id="device-select-hist"></select>
            <label>
              Desde:
              <span class="tooltip-container">
                ‚ùì
                <span class="tooltip-text">Selecciona la fecha de inicio. Se buscar√° desde las 00:00 horas.</span>
              </span>
            </label>
            <input type="date" id="date-start-hist">
            <label>
              Hasta:
              <span class="tooltip-container">
                  ‚ùì
                  <span class="tooltip-text">Selecciona la fecha final. Se buscar√° hasta las 23:59 horas.</span>
              </span>
            </label>
            <input type="date" id="date-end-hist">
            <button id="btn-route-hist" class="history-btn">Ver Ruta</button>
            <button class="clear-btn" onclick="limpiarMapa()">Limpiar</button>
        </div>
      </div>

      <div id="view-geofence" class="content-view" style="display: none;">
        <div class="info-box">
          <span class="tooltip-container">
                ‚ùì Monitoreo dentro de geo-cerca
                <span class="tooltip-text">Usa las herramientas de dibujo en el mapa (circulo, cuadrado o pol√≠gono) para marcar un √°rea, luego selecciona el rango de fechas y analiza.</span>
            </span>
        </div>
        <div class="history-controls">
            <label>Dispositivo:</label><select id="device-select-geo"></select>
            <label>
                Desde:
                <span class="tooltip-container">
                    ‚ùì
                    <span class="tooltip-text">Selecciona la fecha de inicio. Se buscar√° desde las 00:00 horas.</span>
                </span>
            </label>
            <input type="date" id="date-start-geo">
            <label>
              Hasta:
              <span class="tooltip-container">
                  ‚ùì
                  <span class="tooltip-text">Selecciona la fecha final. Se buscar√° hasta las 23:59 horas.</span>
              </span>
            </label>
            <input type="date" id="date-end-geo">
            
            <div class="control-row">
                
                <div class="tooltip-container map-float-icon">
                    ‚ùì
                    <span class="tooltip-text">
                        Muestra los puentos por los que estuvo el dispositivo DENTRO de la figura dibujada.
                    </span>
                </div>
                <button id="btn-analyze-geo" class="history-btn" style="background-color: #6f42c1; flex-grow: 1;">
                    Analizar Zona
                </button>
            </div>
            <button id="btn-delete-shape" class="clear-btn" style="background-color: #dc3545;">üóëÔ∏è Borrar Figura</button>
        </div>
        <div id="geo-results" style="margin-top:10px; font-size:0.9em;"></div>
      </div>

      <button class="btn-salir" onclick="window.location.href='indexLogin.html'">‚èπ Finalizar Sesi√≥n</button>

    </div>
    
    <div id="map"></div>
  </div>

  <script src="scriptConfigFirebase.js"></script>
  <script defer src="scriptPrueba.js"></script>

</body>
</html>